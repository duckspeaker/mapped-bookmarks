<!DOCTYPE html>
<head>
  <title>Bookmarks</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #map-canvas, #map_canvas {
      height: 100%;
    }

    @media print {
      html, body {
        height: auto;
      }

      #map-canvas, #map_canvas {
        height: 650px;
      }
    }

    #panel {
      position: absolute;
      top: 5px;
      left: 50%;
      margin-left: -180px;
      z-index: 5;
      background-color: #fff;
      padding: 5px;
      border: 1px solid #999;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>

  <script>
    var bookmarks = [
      "Saigon shack",
      "Dorado",
      "Triple shot world atlas",
      "Gyu-kaku",
      "Ippudo NY",
      "Jack bistro",
      "Threeofcup",
      "Milon Bangladesh restaurant",
      "Ferrara",
      "mug lounge",
      "Coal yard",
      "Hifi",
      "Sidewalk",
      "Ardesia",
      "Stillwater",
      "caravan of dreams",
      "Buzkadi",
      "Mono + mono",
      "Van leeuwen",
      "lula's sweet apothecary",
      "L'arte del gelato",
      "sullivan street bakery",
      "fat witch bakery",
      "mancora",
      "efendi",
      "Houston hall",
      "Clarke's standard",
      "forty carrots",
      "popbar",
      "dessert club",
      "spanky and darla's",
      "cafe edison",
      "ivy bakery and lounge",
      "red moon",
      "market at 6th and 2nd",
      "Flea market cafe",
      "Cakeshop",
      "ten bells",
      "sorella",
      "lucien",
      "schiller's",
      "stanton social",
      "l'arte del gelato",
      "Le gigot",
      "Vagabond cafe",
      "Peasant",
      "Keybar",
      "Simone",
      "Bleecker st bar",
      "Gmt tavern",
      "Angelica kitchen",
      "The smith"
    ];

    var map;
    var service;
    var infowindow;
    var completedPlaces;

    function initialize() {
      completedPlaces = 0;

      var center = new google.maps.LatLng(40.725161,-73.986958);

      map = new google.maps.Map(document.getElementById('map-canvas'), {
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: center,
        zoom: 13
      });

      addBookmarks();

      function addBookmarks() {
        infowindow = new google.maps.InfoWindow();
        service = new google.maps.places.PlacesService(map);

        for (var i = 0; i < bookmarks.length; i++) {
          searchPlace(bookmarks[i]);
        }
      }

      function searchPlace(placeName) {
          var request = {
            location: center,
            radius: '10000',
            keyword: placeName
          };

          service.nearbySearch(request, function(results, status) {
            if (status == google.maps.places.PlacesServiceStatus.OK) {
              createMarker(results[0]);
              completedPlaces++;
              console.log(placeName + ": " + status + " ("+completedPlaces+"/"+bookmarks.length+")");
            } else if (status == google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT) {
              console.log("retrying: " + placeName);
              setTimeout(function() { searchPlace(placeName); }, Math.random() * 10000);
            } else {
              console.log(status);
            }
          });
      }

      function createMarker(place) {
        var placeLoc = place.geometry.location;
        var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
        });

        google.maps.event.addListener(marker, 'click', function() {
          infowindow.setContent(place.name);
          infowindow.open(map, this);
        });
      }
    }

    google.maps.event.addDomListener(window, 'load', initialize);
  </script>
</head>
<body>
  <div id="map-canvas"></div>
</body>
</html>