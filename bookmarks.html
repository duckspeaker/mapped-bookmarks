<!DOCTYPE html>
<html>
<head>
  <title>Bookmarks</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #map-canvas, #map_canvas {
      height: 100%;
    }

    @media print {
      html, body {
        height: auto;
      }

      #map-canvas, #map_canvas {
        height: 650px;
      }
    }

    #panel {
      position: absolute;
      top: 5px;
      left: 50%;
      margin-left: -180px;
      z-index: 5;
      background-color: #fff;
      padding: 5px;
      border: 1px solid #999;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>

  <script>
    var bookmarks = [
      "Taci's Beyti"
    , "Saigon shack"
    , "Dorado"
    , "Triple shot world atlas"
    , "Gyu-kaku"
    , "Ippudo NY"
    , "Jack bistro"
    , "Threeofcup"
    , "Milon Bangladesh restaurant"
    , "Ferrara"
    , "mug lounge"
    , "Coal yard"
    , "Sidewalk"
    , "Ardesia"
    , "Stillwater"
    , "caravan of dreams"
    , "Buzkadi"
    , "Mono + mono"
    , "lula's sweet apothecary"
    , "L'arte del gelato"
    , "sullivan street bakery"
    , "fat witch bakery"
    , "mancora"
    , "efendi"
    , "Houston hall"
    , "Clarke's standard"
    , "forty carrots"
    , "popbar"
    , "dessert club"
    , "spanky and darla's"
    , "cafe edison"
    , "ivy bakery and lounge"
    , "red moon"
    , "market at 6th and 2nd"
    , "Cakeshop"
    , "sorella"
    , "lucien"
    , "schiller's"
    , "stanton social"
    , "l'arte del gelato"
    , "Le gigot"
    , "Vagabond cafe"
    , "Peasant"
    , "Keybar"
    , "Bleecker st bar"
    , "Gmt tavern"
    , "Angelica kitchen"
    , "The smith"
    , "Xi'an"
    , "Natori"
    , "Yakitori Taisho"
    , "Organic Avenue"
    , "Prima"
    , "Mary o's"
    , "Puck fair"
    , "Local 138"
    , "The Jane Hotel"
    , "Elsa"
    , "Sidebar"
    , "Malbec"
    , "Bomboloni"
    , "Beagle"
    , "Cafe pick me up"
    , "One mile house"
    , "The third man"
    , "Quartino"
    , "Madam geneira"
    , "Jones eats"
    , "Gemma"
    , "Whiskey town"
    , "Feast"
    , "Bar che"
    , "Mighty Quinn's"
    , "Local 92"
    , "A place to eat"
    , "Muji"
    , "Big bar"
    , "Enoteca"
    , "Klimat"
    , "Nomad"
    , "Sigmund's"
    , "Euzkadi"
    , "Five points"
    , "Gramercy park bar"
    , "olde good things"
    , "hotel on rivington"
    , "the park"
    , "the met's rooftop garden"
    , "ink48 hotel"
    , "la quinta"
    , "hotel metro"
    ];

    var map;
    var service;
    var infowindow;
    var completedPlaces;

    function initialize() {
      completedPlaces = 0;

      var center = new google.maps.LatLng(40.725161,-73.986958);

      map = new google.maps.Map(document.getElementById('map-canvas'), {
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: center,
        zoom: 13
      });

      showCurrentLocation();
      addBookmarks();

      function addBookmarks() {
        infowindow = new google.maps.InfoWindow();
        service = new google.maps.places.PlacesService(map);

        for (var i = 0; i < bookmarks.length; i++) {
          searchPlace(bookmarks[i]);
        }
      }

      function searchPlace(placeName) {
        var request = {
          location: center,
          radius: '10000',
          keyword: placeName
        };

        service.nearbySearch(request, function(results, status) {
          if (status == google.maps.places.PlacesServiceStatus.OK) {
            createMarker(results[0]);
            completedPlaces++;
            console.log(placeName + ": " + status + " ("+completedPlaces+"/"+bookmarks.length+")");
          } else if (status == google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT) {
            console.log("retrying: " + placeName);
            setTimeout(function() { searchPlace(placeName); }, Math.random() * 10000);
          } else {
            console.log(status);
          }
        });
      }

      function createMarker(place) {
        var placeLoc = place.geometry.location;
        var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
        });

        google.maps.event.addListener(marker, 'click', function() {
          infowindow.setContent(place.name);
          infowindow.open(map, this);
        });
      }

      function showCurrentLocation() {
        if (navigator.geolocation) {
          var myloc = new google.maps.Marker({
            clickable: false,
            icon: new google.maps.MarkerImage('//maps.gstatic.com/mapfiles/mobile/mobileimgs2.png',
                                              new google.maps.Size(22,22),
                                              new google.maps.Point(0,18),
                                              new google.maps.Point(11,11)),
            shadow: null,
            zIndex: 999,
            map: map
          });

          navigator.geolocation.getCurrentPosition(function(pos) {
            console.log('here');
            var me = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
            myloc.setPosition(me);
          }, function(error) {
              console.log(error);
          });
        }
      }
    }

    google.maps.event.addDomListener(window, 'load', initialize);
  </script>
</head>
<body>
  <div id="map-canvas"></div>
</body>
</html>
